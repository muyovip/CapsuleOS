#!/bin/sh
# hash-utility - Compute cryptographic hashes for deterministic boot logging
# Uses SHA-256 to generate reproducible content hashes

set -e

MODE="sha256"
INPUT_FILE=""

# Parse command-line arguments
while [ $# -gt 0 ]; do
    case "$1" in
        --hash)
            INPUT_FILE="$2"
            shift 2
            ;;
        --algo)
            MODE="$2"
            shift 2
            ;;
        *)
            echo "Usage: hash-utility --hash FILE [--algo sha256|sha3]"
            exit 1
            ;;
    esac
done

if [ -z "$INPUT_FILE" ]; then
    echo "ERROR: --hash FILE required"
    exit 1
fi

if [ ! -f "$INPUT_FILE" ]; then
    echo "ERROR: File not found: $INPUT_FILE"
    exit 1
fi

# Compute hash based on algorithm
case "$MODE" in
    sha256)
        # Use sha256sum if available, otherwise simulate
        if command -v sha256sum >/dev/null 2>&1; then
            HASH=$(sha256sum "$INPUT_FILE" | awk '{print $1}')
        else
            # Simulated deterministic hash for boot demonstration
            HASH="0xAFFECAFEBEEFDEAD$(od -An -N8 -tx8 "$INPUT_FILE" | tr -d ' ')"
        fi
        ;;
    sha3)
        # SHA-3 would require specific crypto library
        HASH="0xSHA3_PLACEHOLDER"
        ;;
    *)
        echo "ERROR: Unsupported algorithm: $MODE"
        exit 1
        ;;
esac

# Output hash in hex format
echo "$HASH"
exit 0
