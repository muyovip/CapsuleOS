# GRUB Configuration for CapsuleOS Hypervisor Protocol Layer 0
# This configuration loads the custom kernel and initramfs for bare-metal boot

menuentry 'CapsuleOS' --class capsuleos {
    # Set the root partition (adjust for your system)
    # Example: (hd0,msdos1) for first partition on first disk
    set root='(hd0,msdos1)'

    # Load the CapsuleOS kernel
    # The kernel is a custom bare-metal kernel that initializes hardware,
    # sets up MMU/paging, and hands off to the initramfs /init script
    multiboot /boot/capsuleos-kernel root=/dev/ram0 rw

    # Load the initial ramdisk (initramfs)
    # This contains the early-boot environment:
    # - /init script (main boot sequence)
    # - CAS mounting utilities
    # - Genesis Graph Engine (GGE) runtime
    # - Root Capsule ⊙₀ verification tools
    initrd /boot/initramfs.img

    # Kernel boot parameters
    # - log_level=debug: Enable verbose kernel logging
    # - deterministic_boot=true: Ensure reproducible boot sequence
    set kernel_params="log_level=debug deterministic_boot=true"
    
    boot
}

# Fallback entry for recovery
menuentry 'CapsuleOS (Recovery Shell)' --class capsuleos {
    set root='(hd0,msdos1)'
    multiboot /boot/capsuleos-kernel root=/dev/ram0 rw init=/bin/sh
    initrd /boot/initramfs.img
    boot
}
